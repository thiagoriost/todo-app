<div class="history-container"
  (click)="cerrarMenu()"
>
  <h2>Historial de Tareas</h2>

  <div class="filters">
    <select class="filter-select" (change)="filterByAction($event)">
      <option value="">Todas las acciones</option>
      <option value="created">Creadas</option>
      <option value="updated">Actualizadas</option>
      <option value="status_changed">Cambio de Estado</option>
      <option value="completed">Completadas</option>
      <option value="deleted">Eliminadas</option>
    </select>

    <input
      type="date"
      class="date-filter"
      (change)="filterByDate($event)"
      placeholder="Filtrar por fecha"
    >
  </div>

  @if (loading()) {
    <div class="loading">Cargando historial...</div>
  } @else if (filteredHistory().length === 0) {
    <div class="empty">No hay historial disponible</div>
  } @else {
    <div class="timeline">
      @for (entry of filteredHistory(); track entry.id) {
        <div class="timeline-item" [class]="entry.action">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <div class="timeline-header">
              <span class="action-badge" [class]="entry.action">
                {{ getActionLabel(entry.action) }}
              </span>
              <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
            </div>
            <div class="timeline-body">
              <p><strong>Tarea:</strong> {{ entry.taskTitle }}</p>

              @if (entry.oldStatus && entry.newStatus) {
                <div class="status-change">
                  <span class="old-status">{{ entry.oldStatus }}</span>
                  <span class="arrow">â†’</span>
                  <span class="new-status">{{ entry.newStatus }}</span>
                </div>
              }

              @if (entry.changes && hasChanges(entry.changes)) {
                <div class="changes">
                  <strong>Cambios:</strong>
                  <ul>
                    @for (change of getChangesList(entry.changes); track change) {
                      <li>{{ change }}</li>
                    }
                  </ul>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
